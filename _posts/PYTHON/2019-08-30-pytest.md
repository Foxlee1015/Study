---
layout: post
title: Pytest
categories: PYTHON

---

1. 가상환경
2. pip install pytest
3. pytest 를 실행하면 그 내부에 test_*.py 모두 실행


# api.py


        from flask import Flask
        from flask_restful import Resource, Api, reqparse
        import json

        app = Flask(__name__)
        api = Api(app)


        # DB
        class test_db():
            test_id = [1, 2, 3, 4]
            username_list = ['daehan', 'admin']


        # Compare each variable with the data in DB
        class test_list(Resource, test_db):
            def __init__(self):
                print('start')
                parser = reqparse.RequestParser()
                parser.add_argument('username')

                self.parser = parser
                self.test_list = test_db.test_id
                self.username_list = test_db.username_list

            def get(self, test_id):
                if test_id in self.test_list:
                    return {'status': 'ok'}
                else:
                    return {'status': 'fail'}

            def put(self, test_id):
                args = self.parser.parse_args()
                username = args['username']

                if username in self.username_list:
                    result = { "username" : username, "test_id" : test_id }
                    return {"status": 'ok', 'result' : result }
                else:
                    return {"status": 'fail'}

            def post(self, test_id):
                args = self.parser.parse_args()
                username = args['username']

                if username in self.username_list:
                    result = {"username": username, "test_id": test_id}
                    return {"status": 'ok', 'result': result}
                else:
                    return {"status": 'fail'}

            def delete(self, test_id):
                if test_id in self.test_list:
                    result = "{} Deleted".format(test_id)
                    return {"status": 'ok', 'result': result}
                else:
                    return {"status": 'fail'}


        api.add_resource(test_list, '/test/<int:test_id>')

        if __name__ == '__main__':
            app.run(debug=True)
            
            
test_api.py



        """
        ==========================
        Test for API classes
        ==========================
        """

        import pytest
        import json
        import sys

        sys.path.append(".")
        from api import app

        test_id = 1
        username = 'daehan'

        @pytest.fixture
        def client():
            client = app.test_client()
            yield client


        # Test each method with the test_id and the username above
        # Test cases
        def test_get(client):
            rv = client.get('/test/{}'.format(test_id), follow_redirects=True)
            assert 'ok' in json.loads(rv.data.decode("utf-8"))['status']

        def test_put(client):
            data = {'username' : username}
            rv = client.put('/test/{}'.format(test_id), data=data, follow_redirects=True)
            assert 'ok' in json.loads(rv.data.decode("utf-8"))['status']

        def test_post(client):
            data = {'username' : username}
            rv = client.put('/test/{}'.format(test_id), data=data, follow_redirects=True)
            assert 'ok' in json.loads(rv.data.decode("utf-8"))['status']

        def test_delete(client):
            rv = client.get('/test/{}'.format(test_id), follow_redirects=True)
            assert 'ok' in json.loads(rv.data.decode("utf-8"))['status']

